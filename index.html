<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹é‹è¡Œæƒ…å ±</title>
    <style>
        :root { --primary: #007AFF; --bg: #F2F2F7; --accent: #34C759; }
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; padding-bottom: 100px; /* ç‚ºåº•éƒ¨æ‡¸æµ®çª—é ç•™ç©ºé–“ */ }
        .container { max-width: 500px; margin: auto; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { margin-top: 0; font-size: 1.1rem; border-bottom: 2px solid var(--bg); padding-bottom: 10px; color: #444; }
        .status-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; margin-bottom: 15px; }
        .weekday { background: #E3F2FD; color: #1976D2; }
        .weekend { background: #FFEBEE; color: #D32F2F; }
        .result-item { margin: 20px 0; border-left: 4px solid var(--primary); padding-left: 15px; }
        .location { font-size: 0.9rem; color: #777; font-weight: bold; }
        .next-time { font-size: 1.8rem; font-weight: 800; color: var(--primary); display: block; margin-top: 5px; }
        .error-msg { font-size: 0.95rem; color: #D32F2F; font-weight: bold; line-height: 1.4; }
        textarea { width: 100%; height: 70px; border: 1px solid #DDD; border-radius: 8px; padding: 10px; box-sizing: border-box; font-size: 0.9rem; font-family: monospace; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; font-size: 0.85rem; color: #555; }
        .holiday-toggle { background: #fff; padding: 12px 20px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border: 1px solid #ddd; }
        
        /* å³ä¸‹è§’æ‡¸æµ®çª—æ¨£å¼ */
        .floating-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 160px;
            background: rgba(44, 44, 46, 0.95);
            color: white;
            padding: 12px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 0.8rem;
        }
        .widget-title { font-weight: bold; font-size: 0.7rem; color: #AAA; margin-bottom: 5px; border-bottom: 1px solid #444; padding-bottom: 3px; }
        .widget-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .widget-val { font-weight: bold; color: #5AC8FA; }
        .widget-val.over { color: #FF453A; font-size: 0.7rem; }

        .footer { text-align: center; font-size: 0.8rem; color: #999; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div id="dayTypeTag" class="status-tag">å–å¾—ä¸­...</div>
        
        <div class="result-item">
            <span class="location">å“å·é§… ç™º (Shinagawa)</span>
            <span id="shinagawaNext" class="next-time">--:--</span>
        </div>
        <div class="result-item">
            <span class="location">ãƒ›ãƒ†ãƒ« ç™º (Hotel)</span>
            <span id="hotelNext" class="next-time">--:--</span>
        </div>
    </div>

    <div class="holiday-toggle">
        <span style="font-weight: bold;">ä»Šæ—¥ã¯ç¥æ—¥ã§ã™ã‹ï¼Ÿ</span>
        <input type="checkbox" id="holidayManual" onchange="updateDisplay()" style="width: 20px; height: 20px;">
    </div>

    <div class="card">
        <h2>æ™‚åˆ»è¡¨è¨­å®š</h2>
        <label>ğŸ“… å¹³æ—¥ - å“å·é§…ï¼š</label>
        <textarea id="s_weekday">07:54, 08:08, 08:22, 08:36, 08:51, 09:07, 09:23, 09:39, 09:56, 10:14, 10:48, 11:22, 11:56, 12:30, 13:04, 13:48, 14:12, 14:46, 15:20, 15:54, 16:27, 17:00, 17:32, 18:03, 18:34, 19:06</textarea>
        <label>ğŸ“… å¹³æ—¥ - ãƒ›ãƒ†ãƒ«ï¼š</label>
        <textarea id="h_weekday">07:57, 08:11, 08:25, 08:40, 08:55, 09:11, 09:28, 09:46, 10:20, 10:54, 11:28, 12:02, 12:36, 13:10, 13:44, 14:18, 14:52, 15:26, 16:00, 16:34, 17:06, 17:37, 18:08, 18:39, 19:10</textarea>

        <label style="margin-top:20px;">ğŸ‰ åœŸæ—¥ç¥ - å“å·é§…ï¼š</label>
        <textarea id="s_weekend">09:27, 10:00, 10:34, 11:08, 11:42, 12:16, 12:50, 13:24, 13:58, 14:32, 15:06 15:40, 16:14, 16:48, 17:22, 17:56, 18:31, 19:06</textarea>
        <label>ğŸ‰ åœŸæ—¥ç¥ - ãƒ›ãƒ†ãƒ«ï¼š</label>
        <textarea id="h_weekend">09:01, 09:33, 10:06, 10:40, 11:14, 11:48, 12:22, 12:56, 13:30, 14:04, 14:38, 15:12, 15:46, 16:20, 16:54, 17:28, 18:02, 18:36, 19:10</textarea>
    </div>

    <div class="footer">
        ç¾åœ¨æ™‚åˆ»ï¼š<span id="currentTime"></span>
    </div>
</div>

<div class="floating-widget" id="miniWidget">
    <div class="widget-title">NEXT BUS</div>
    <div class="widget-row">
        <span>å“å·é§…:</span>
        <span id="w-shinagawa" class="widget-val">--:--</span>
    </div>
    <div class="widget-row">
        <span>ãƒ›ãƒ†ãƒ«:</span>
        <span id="w-hotel" class="widget-val">--:--</span>
    </div>
</div>

<script>
    function isWeekend() {
        const now = new Date();
        const day = now.getDay();
        return (day === 0 || day === 6 || document.getElementById('holidayManual').checked);
    }

    function getNextBus(inputStr) {
        const schedule = inputStr.split(/[\s,ï¼Œ]+/)
            .filter(t => t.match(/^([01]\d|2[0-3]):([0-5]\d)$/))
            .sort();
        const now = new Date();
        const nowStr = now.getHours().toString().padStart(2, '0') + ":" + 
                       now.getMinutes().toString().padStart(2, '0');
        const nextBus = schedule.find(time => time > nowStr);
        return nextBus || "çµ‚ä¾¿çµ‚äº†";
    }

    function updateDisplay() {
        const weekendMode = isWeekend();
        const tag = document.getElementById('dayTypeTag');
        tag.innerText = weekendMode ? "æœ¬æ—¥ï¼šåœŸæ—¥ç¥ãƒ€ã‚¤ãƒ¤" : "æœ¬æ—¥ï¼šå¹³æ—¥ãƒ€ã‚¤ãƒ¤";
        tag.className = "status-tag " + (weekendMode ? "weekend" : "weekday");

        const sInput = weekendMode ? 's_weekend' : 's_weekday';
        const hInput = weekendMode ? 'h_weekend' : 'h_weekday';

        const nextS = getNextBus(document.getElementById(sInput).value);
        const nextH = getNextBus(document.getElementById(hInput).value);

        // ä¸»ç•«é¢æ›´æ–°
        const sElem = document.getElementById('shinagawaNext');
        const hElem = document.getElementById('hotelNext');
        sElem.innerText = nextS === "çµ‚ä¾¿çµ‚äº†" ? "ã€ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€çµ‚ä¾¿ã¯æ—¢ã«å‡ºç™ºã•ã‚Œã¾ã—ãŸã€‘" : nextS;
        hElem.innerText = nextH === "çµ‚ä¾¿çµ‚äº†" ? "ã€ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€çµ‚ä¾¿ã¯æ—¢ã«å‡ºç™¼ã•ã‚Œã¾ã—ãŸã€‘" : nextH;
        sElem.className = nextS === "çµ‚ä¾¿çµ‚äº†" ? "error-msg" : "next-time";
        hElem.className = nextH === "çµ‚ä¾¿çµ‚äº†" ? "error-msg" : "next-time";

        // å°è¦–çª—æ›´æ–°
        const ws = document.getElementById('w-shinagawa');
        const wh = document.getElementById('w-hotel');
        ws.innerText = nextS;
        wh.innerText = nextH;
        ws.className = nextS === "çµ‚ä¾¿çµ‚äº†" ? "widget-val over" : "widget-val";
        wh.className = nextH === "çµ‚ä¾¿çµ‚äº†" ? "widget-val over" : "widget-val";

        document.getElementById('currentTime').innerText = new Date().toLocaleTimeString('ja-JP');
    }

    setInterval(updateDisplay, 1000);
    updateDisplay();
</script>

</body>
</html>
